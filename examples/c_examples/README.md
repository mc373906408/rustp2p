# RustP2P C语言示例

本目录包含使用RustP2P库的C语言示例程序，用于演示如何在C程序中使用P2P功能。

## 编译方法

可以使用项目根目录下的`build-x64.sh`脚本进行编译：

```bash
cd /root/rustp2p
./build-x64.sh
```

编译成功后，可执行文件将位于`examples/c_examples/build/`目录下。

## 示例程序

### TCP P2P通信 (tcp_test)

这个程序演示了基本的P2P直接点对点消息通信功能，支持两种模式：服务器模式和客户端模式。

#### 使用方法

```bash
# 服务器模式 - 作为节点发现服务
./tcp_test <本地IP> <TCP端口> <UDP端口> <组代码> -s

# 客户端模式 - 可以向任意对等节点直接发送消息
./tcp_test <本地IP> <TCP端口> <UDP端口> <组代码> -c <服务器地址>
```

#### 示例

首先在服务器节点上运行（作为节点发现服务）：

```bash
./tcp_test 121.41.107.198 23333 23334 12345678 -s
```

然后在客户端节点上运行：

```bash
./tcp_test 192.168.1.100 23335 23336 12345678 -c 121.41.107.198:23333
```

连接建立后，在客户端输入以下格式的消息**直接**发送给其他客户端：

```
192.168.1.101:你好，这是一条测试消息
```

上面的格式中，冒号前是目标节点的IP地址，冒号后是要发送的消息内容。消息将直接从发送方发送到目标节点，无需服务器转发。

## 程序特性

1. **服务器模式**
   - 作为节点发现服务存在
   - 帮助客户端之间建立连接
   - 客户端可以通过服务器找到其他客户端

2. **客户端模式**
   - 先连接到服务器获取网络信息
   - 可以直接向任何IP地址发送消息
   - 自动尝试添加目标节点作为对等节点
   - 失败时自动重试不同端口配置

## 注意事项

1. 需要确保所有节点的TCP和UDP端口都已经开放
2. 组代码应该在通信双方保持一致
3. 确保正确设置本地IP地址
4. 如果遇到连接问题，客户端会自动尝试多种方式建立连接
5. 程序支持在Ctrl+C时优雅退出，释放资源
6. 目前的示例使用了AES-GCM和ChaCha20-Poly1305加密算法支持，但默认未启用
7. 首次向新节点发送消息可能需要几秒钟时间建立连接 